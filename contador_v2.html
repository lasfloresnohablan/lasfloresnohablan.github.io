<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilometros por la salud - contador</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;400;700&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/contador.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    
    <style>
        /* Add some basic styling */
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .big_numbers {
            font-size: 2em;
            color: #333;
        }
        .flipclock_b {
            font-size: 1.2em;
        }
        .row {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        form input {
            padding: 5px;
        }
    </style>
</head>
<body>

<div class="row" style="background-color: #222222; padding: 20px;">
    <div class="three columns">
        <p class="dashboard-items_kmx">[ Viernes <b>25</b> ]</p>
        <div class="border_1_kmx">
            <p id="displayNumber1" class="big_numbers">0</p>
        </div>
    </div>
    <div class="three columns">
        <p class="dashboard-items_kmx">[ Sábado <b>26</b> ]</p>
        <div class="border_1_kmx">
            <p id="displayNumber2" class="big_numbers">0</p>
        </div>
    </div>
    <div class="three columns">
        <p class="dashboard-items_kmx">[ Domingo <b>27</b> ]</p>
        <div class="border_1_kmx">
            <p id="displayNumber3" class="big_numbers">0</p>
        </div>
    </div>
    <div class="three columns">
        <p class="dashboard-items_kmx">[ total ]</p>
        <p id="displaySum" class="big_numbers" style="font-weight: bold;">0</p>
        <p class="flipclock_b">Kilómetros</p>
    </div>
</div>

<div class="row" style="background-color: #333333; padding: 20px; color: white;">
    <h2>Submit Kilometers</h2>
    <form id="kmForm">
        <label for="km1">Kilómetros para Viernes:</label>
        <input type="number" id="km1" required>
        <br>
        <label for="km2">Kilómetros para Sábado:</label>
        <input type="number" id="km2" required>
        <br>
        <label for="km3">Kilómetros para Domingo:</label>
        <input type="number" id="km3" required>
        <br>
        <button type="submit">Enviar</button>
    </form>
</div>

<script>
// Your Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyCjQ0bA4lVhBmPrpU41uqnWfwjmLMihzYk",
    authDomain: "kmxsalud-database.firebaseapp.com",
    projectId: "kmxsalud-database",
    storageBucket: "kmxsalud-database.appspot.com",
    messagingSenderId: "216946537560",
    appId: "1:216946537560:web:02019702598e3571bc062d"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);

// Initialize Firestore
const db = firebase.firestore();

// Function to listen for changes in the database
function listenForChanges() {
    db.collection("numbers").doc("kmx").onSnapshot((doc) => {
        if (doc.exists) {
            let data = doc.data();
            console.log("Live data update: ", data); // Debug line
            
            let number1 = data.number1 || 0;
            let number2 = data.number2 || 0;
            let number3 = data.number3 || 0;

            // Update the HTML elements with the numbers
            document.getElementById("displayNumber1").innerText = number1;
            document.getElementById("displayNumber2").innerText = number2;
            document.getElementById("displayNumber3").innerText = number3;

            // Calculate and display the sum in the fourth position
            let sum = number1 + number2 + number3;
            document.getElementById("displaySum").innerText = sum;
        } else {
            console.log("No such document!"); // Debug line
        }
    });
}

// Form submission event listener
document.getElementById("kmForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent the page from reloading

    let number1 = parseInt(document.getElementById("km1").value);
    let number2 = parseInt(document.getElementById("km2").value);
    let number3 = parseInt(document.getElementById("km3").value);

    // Check if inputs are valid
    console.log(`Inputs: ${number1}, ${number2}, ${number3}`);

    // Check if any input is NaN
    if (isNaN(number1) || isNaN(number2) || isNaN(number3)) {
        console.error("One of the inputs is not a number.");
        return; // Prevent submission if inputs are invalid
    }

    // Update Firestore with the new values
    db.collection("numbers").doc("kmx").set({
        number1: number1,
        number2: number2,
        number3: number3
    }).then(() => {
        console.log("Document successfully written!");
        // Clear the input fields
        document.getElementById("kmForm").reset();
    }).catch((error) => {
        console.error("Error writing document: ", error);
    });
});

// Call this function on load
window.onload = function() {
    listenForChanges(); // Real-time updates
};
</script>
</body>
</html>
